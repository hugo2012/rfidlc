sap.ui.define(["com/bosch/rbf0/lo/rfidlc/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/Log"],function(e,t,o,i,a){"use strict";return e.extend("com.bosch.rbf0.lo.rfidlc.controller.Startup",{onInit:function(){var e=new t({Gate:"",WarehouseNo:"",enableGate:false});this.setModel(e,"startupView");this.getRouter().getRoute("startup").attachPatternMatched(this._onStartupMatched,this);this.getRouter().getRoute("startupAlias").attachPatternMatched(this._onStartupMatchedAlias,this)},_onStartupMatchedAlias:function(e){this._onStartupMatched()},_onStartupMatched:function(){this.setAppBusy(true);this.getModel().metadataLoaded().then(function(){this.getModel().setSizeLimit(500);var e=this.getView().byId("idWarehouseNo");e.setMaxLength(4);var t=this.getView().byId("idGate"),o=this.getModel().getProperty("/#Gates/Gate/@maxLength"),i=parseInt(o,10);t.setMaxLength(i);this._loadUserParameters().then(function(e){var t=e.results,o,i;for(var a=0;a<t.length;a++){if(o!==undefined&&i!==undefined){break}var s=t[a];if(s.Field==="/RB4R/LO_LOAD_LGNUM"){o=s.Value}if(s.Field==="/RB4R/LO_LOAD_GATE"){i=s.Value}}if(o!==undefined&&i!==undefined){this.getRouter().navTo("monitor",{WarehouseNo:o,gate:i})}this.setAppBusy(false)}.bind(this),function(){a.error("Error while loading user parameters")})}.bind(this))},onWarehouseNoSuggestionSelected:function(e){window.setTimeout(function(){this._loadGateData()}.bind(this),100)},onWarehouseNoLiveChange:function(){this.getModel("startupView").setProperty("/enableGate",false);this.getModel("startupView").setProperty("/Gate","")},onWarehouseNoSubmit:function(){var e=this.getModel("startupView"),t=e.getProperty("/WarehouseNo");e.setProperty("/WarehouseNo",t.toUpperCase());var o=this._checkField("idWarehouseNo");if(o){this._loadGateData()}},onGateSuggestionSelected:function(){window.setTimeout(function(){this.handleToMonitorPress()}.bind(this),100)},onGateSubmit:function(){var e=this.getModel("startupView"),t=e.getProperty("/Gate");e.setProperty("/Gate",t.toUpperCase());this.handleToMonitorPress()},handleToMonitorPress:function(){var e=this._checkField("idWarehouseNo"),t=this._checkField("idGate");if(e&&t){var o=this.getModel("startupView").getProperty("/Gate"),i=this.getModel("startupView").getProperty("/WarehouseNo");this.getRouter().navTo("monitor",{WarehouseNo:i,gate:o})}},_checkField:function(e){var t=this.getModel("startupView"),o=t.getProperty("/WarehouseNo"),i=t.getProperty("/Gate"),a=this.getView().byId(e),s=a.getBindingInfo("suggestionItems"),r=s.binding.getCurrentContexts(),n=false,u=this.getModel();for(var h=0;h<r.length;h++){var d=r[h],l=u.getProperty(d.sPath);if(e==="idWarehouseNo"){if(l.WarehouseNo===o){n=true;break}}else{if(l.WarehouseNo===o&&l.Gate===i){n=true;break}}}return n},_loadGateData:function(){var e=this.getModel("startupView"),t=e.getProperty("/WarehouseNo"),a=this.getView().byId("idGate"),s=a.getBindingInfo("suggestionItems"),r=[new o("WarehouseNo",i.EQ,t)],n=this.getModel();a.bindAggregation("suggestionItems",{path:s.path,template:s.template,filters:r,events:{dataRequested:function(){n.metadataLoaded().then(function(){a.setBusy(true)})},dataReceived:function(){a.setBusy(false);e.setProperty("/enableGate",true);window.setTimeout(function(){a.focus();a.fireSuggest({suggestValue:""})}.bind(this),100)}}})},_loadUserParameters:function(){var e=new Promise(function(e,t){var o=[];this.getModel().read("/UserDefaultParametersSet",{filters:o,success:function(t,o){e(t)},error:function(){t()}})}.bind(this));return e}})});
//# sourceMappingURL=Startup.controller.js.map